/*!
 * Copyright (c) 2011-2012 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
(function(a){a.extend(myatu_bgm,{SetTimer:function(){if(background_manager_vars.change_freq<=0){return}if(myatu_bgm.timer){clearTimeout(myatu_bgm.timer)}myatu_bgm.timer=setTimeout("myatu_bgm.SwitchBackground()",background_manager_vars.change_freq*1000)},AnimationCompleted:function(){a("#myatu_bgm_top").css({left:"",top:""});a("#myatu_bgm_prev").remove();myatu_bgm.SetTimer()},AnimateSlide:function(n,f,q){var m=a("#myatu_bgm_top"),g=a("#myatu_bgm_prev"),r="-9000px",d="9000px",e="top",j=new Object,i=a(window).width(),l=((m.width()-i)*100)/i,h=(150+l)+"%",k="-"+(50+l)+"%",c=function(p){p=String(p);return(p.charAt(p.length-1)=="%")};switch(n){case"top":m.show();r="-"+m.height()+"px";d=m.height()+"px";m.hide();break;case"bottom":r=g.height()+"px";d="-"+g.height()+"px";break;case"left":e="left";var b=c(m.css(e));r=(b)?k:"-"+i+"px";d=(b)?h:i+"px";break;case"right":e="left";var b=c(m.css(e));r=(b)?h:i+"px";d=(b)?k:"-"+i+"px";break}var o=m.css(e);m.css(e,r).show();if(q==undefined||q==false){j[e]=d;g.animate(j,{duration:f,queue:false})}j[e]=o;m.animate(j,{duration:f,queue:false,complete:myatu_bgm.AnimationCompleted})},OnBackgroundClick:function(b){if(b.target==this||a(b.target).hasClass("myatu_bgm_fs")){window.open(b.data.url);return false}},OnBackgroundHover:function(b){a(this).css("cursor",(b.target==this||a(b.target).hasClass("myatu_bgm_fs"))?"pointer":"auto")},SetBackgroundLink:function(d){var c=a("body");c.unbind("click",myatu_bgm.OnBackgroundClick).unbind("mouseover",myatu_bgm.OnBackgroundHover).css("cursor","auto");if(d!=""&&d!="#"){c.bind("click",{url:d},myatu_bgm.OnBackgroundClick).bind("mouseover",myatu_bgm.OnBackgroundHover)}},UrlReplaceQueryArgVal:function(d,e,b){var c=new RegExp("(?![?&])"+e+"=(.*?(?=\\?|\\&(?!amp;)|#|$))","ig");return d.replace(c,e+"="+encodeURIComponent(b))},SwitchBackground:function(){var e=(background_manager_vars.is_fullsize=="true"),b=(e)?a("#myatu_bgm_top").attr("src"):a("body").css("background-image"),d=myatu_bgm.GetAjaxData("random_image",{prev_img:b,active_gallery:background_manager_vars.active_gallery});if(!d){return}myatu_bgm.SetBackgroundLink(d.bg_link);if(e){a("#myatu_bgm_top").clone().attr("id","myatu_bgm_prev").appendTo("body");a("#myatu_bgm_top").hide().unbind("load").attr({src:d.url,alt:d.alt}).imgLoaded(function(){var g=d.transition_speed,h=false;switch(d.transition){case"none":a(this).show();myatu_bgm.AnimationCompleted();break;case"coverdown":h=true;case"slidedown":myatu_bgm.AnimateSlide("top",g,h);break;case"coverup":h=true;case"slideup":myatu_bgm.AnimateSlide("bottom",g,h);break;case"coverright":h=true;case"slideright":myatu_bgm.AnimateSlide("left",g,h);break;case"coverleft":h=true;case"slideleft":myatu_bgm.AnimateSlide("right",g,h);break;default:a("#myatu_bgm_prev").animate({opacity:0},{duration:d.transition_speed,queue:false});a(this).fadeIn(d.transition_speed,myatu_bgm.AnimationCompleted);break}})}else{a("body").css("background-image",'url("'+d.url+'")');myatu_bgm.SetTimer()}if(a("#myatu_bgm_info_tab").length){if(a.isFunction(a("#myatu_bgm_info_tab").qtip)){a("#myatu_bgm_info_tab").qtip("api").hide()}a(".myatu_bgm_info_tab a").attr("href",d.link);a(".myatu_bgm_info_tab_content img").attr("src",d.thumb);a(".myatu_bgm_info_tab_content h3").text(d.caption);a(".myatu_bgm_info_tab_desc").html(d.desc)}if(a("#myatu_bgm_pin_it_btn").length){var c=a("#myatu_bgm_pin_it_btn iframe").attr("src"),f=d.desc.replace(/(<([^>]+)>)/ig,"");c=myatu_bgm.UrlReplaceQueryArgVal(c,"media",d.url);c=myatu_bgm.UrlReplaceQueryArgVal(c,"description",f);a("#myatu_bgm_pin_it_btn iframe").attr("src",c)}}});a(document).ready(function(b){myatu_bgm.SetTimer();myatu_bgm.SetBackgroundLink(b("#myatu_bgm_bg_link").attr("href"));b("#myatu_bgm_bg_link").remove();if(b.isFunction(b("#myatu_bgm_info_tab").qtip)){b("#myatu_bgm_info_tab").qtip({content:{text:function(c){var d=b(".myatu_bgm_info_tab_content").clone();b("h3",d).remove();if(b(".myatu_bgm_info_tab_desc",d).text()===""){b("img",d).css("margin",0)}else{b("img",d).css({width:"100px",height:"100px"})}return d},title:{text:function(c){return b(".myatu_bgm_info_tab_content:first h3").text()},button:true}},style:{classes:"ui-tooltip-dark ui-tooltip-shadow"},events:{hide:function(d,c){b(".myatu_bgm_info_tab_content:last").remove()}},hide:false,position:{adjust:{x:-10,},viewport:b(window)}})}})})(jQuery);
