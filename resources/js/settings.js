/*
 * Copyright (c) 2011-2012 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
(function(a){a.extend(myatu_bgm,{showHide:function(d,b,c){if(c==undefined){c="slow"}(b)?a(d).show(c):a(d).hide(c)},showHideLayoutTable:function(b){var c=(a('input[name="background_size"]:checked').val()=="full");myatu_bgm.showHide(".bg_fs_layout",c);myatu_bgm.showHide(".bg_extra_layout",!c,false);myatu_bgm.updateBackgroundOpacity((!c)?100:false);myatu_bgm.showHideBackgroundTransition()},showHideInfoExtra:function(){myatu_bgm.showHide(".info_tab_extra",a("#info_tab:checked").length)},showHidePinItBtnExtra:function(){myatu_bgm.showHide(".pin_it_btn_extra",a("#pin_it_btn:checked").length)},showHideBackgroundTransition:function(){var c=(a('input[name="background_size"]:checked').val()=="full"),b=(a('input[name="change_freq"]:checked').val()=="custom");myatu_bgm.showHide(".bg_transition",(c&&b))},updatePreviewColor:function(){var b=a("#background_color").val();if(b&&b.charAt(0)=="#"){if(b.length>1){a("#bg_preview_bg_color").css("background-color",b);a("#clear_color").show()}else{a("#bg_preview_bg_color").css("background-color","");a("#clear_color").hide()}}},updateOpacity:function(f,d,e){var c=a(d).val(),b="100";if(f){c=f}if(c<10){b=".0"+c}else{if(c<100){b="."+c}}a(e).css("opacity",b)},updateBackgroundOpacity:function(b){myatu_bgm.updateOpacity(b,"#background_opacity","#bg_preview")},updateOverlayOpacity:function(){myatu_bgm.updateOpacity(false,"#overlay_opacity","#bg_preview_overlay")},updatePreviewOverlay:function(){var b=myatu_bgm.GetAjaxData("overlay_data",a("#active_overlay option:selected").val());if(b){a("#bg_preview_overlay").css("background","url('"+b+"') repeat fixed top left transparent")}else{a("#bg_preview_overlay").css("background","")}},updatePreviewGallery:function(){var c=a("#active_gallery option:selected").val(),b=myatu_bgm.GetAjaxData("random_image",{active_gallery:c,prev_img:"none"});if(b){a("#bg_preview").css("background-image","url('"+b.thumb+"')")}else{a("#bg_preview").css("background-image","")}},updatePreviewLayout:function(){var f=a('input[name="background_size"]:checked').val(),c=a('input[name="background_position"]:checked').val().replace("-"," "),e=a('input[name="background_repeat"]:checked').val(),d=(a("#background_stretch_horizontal:checked").length==1),b=(a("#background_stretch_vertical:checked").length==1);if(f=="full"){a("#bg_preview").css({"background-size":"100% auto","background-repeat":"no-repeat","background-position":"50% 50%",})}else{a("#bg_preview").css({"background-size":((d)?"100%":"50px")+" "+((b)?"100%":"50px"),"background-repeat":e,"background-position":c,})}},clearColor:function(){a("#background_color").val("#");myatu_bgm.updatePreviewColor();return false}});a(document).ready(function(c){c("#background_color").focusin(function(){c("#color_picker").show()}).focusout(function(){c("#color_picker").hide();myatu_bgm.updatePreviewColor()}).keyup(function(){if(this.value.charAt(0)!="#"){this.value="#"+this.value}c.farbtastic("#color_picker").setColor(c("#background_color").val());myatu_bgm.updatePreviewColor()});c("#color_picker").farbtastic(function(f){c("#background_color").attr("value",f);myatu_bgm.updatePreviewColor()});c.farbtastic("#color_picker").setColor(c("#background_color").val());c("#opacity_picker").slider({value:c("#background_opacity").val(),range:"min",min:1,max:100,slide:function(f,g){c("#background_opacity").val(g.value);c("#opacity_picker_val").text(g.value+"%");myatu_bgm.updateBackgroundOpacity()}});c("#ov_opacity_picker").slider({value:c("#overlay_opacity").val(),range:"min",min:1,max:100,slide:function(f,g){c("#overlay_opacity").val(g.value);c("#ov_opacity_picker_val").text(g.value+"%");myatu_bgm.updateOverlayOpacity()}});c("#transition_speed_picker").slider({value:7600-c("#transition_speed").val(),min:100,max:7500,step:100,slide:function(f,g){c("#transition_speed").val(7600-g.value);myatu_bgm.updateOpacity()}});myatu_bgm.updatePreviewColor();myatu_bgm.updateBackgroundOpacity();myatu_bgm.updateOverlayOpacity();c("#info_tab").click(myatu_bgm.showHideInfoExtra);myatu_bgm.showHideInfoExtra();c("#pin_it_btn").click(myatu_bgm.showHidePinItBtnExtra);myatu_bgm.showHidePinItBtnExtra();c('input[name="background_size"]').change(myatu_bgm.showHideLayoutTable);myatu_bgm.showHideLayoutTable();c("#active_gallery").change(myatu_bgm.updatePreviewGallery);myatu_bgm.updatePreviewGallery();c("#active_overlay").change(myatu_bgm.updatePreviewOverlay);myatu_bgm.updatePreviewOverlay();c('input[name="background_size"]').change(myatu_bgm.updatePreviewLayout);myatu_bgm.updatePreviewLayout();c('input[name="background_position"]').change(myatu_bgm.updatePreviewLayout);c('input[name="background_repeat"]').change(myatu_bgm.updatePreviewLayout);c("#background_stretch_horizontal").click(myatu_bgm.updatePreviewLayout);c("#background_stretch_vertical").click(myatu_bgm.updatePreviewLayout);c("#clear_color").click(myatu_bgm.clearColor);c('input[name="change_freq"]').change(myatu_bgm.showHideBackgroundTransition);c("#footer_debug_link").click(function(){c("#footer_debug").toggle();return false});var d=35,e=c("#bg_preview_div"),b=e.offset().top;c(window).scroll(function(){var f=c(window).scrollTop()-c("#screen-meta").height(),g=c("#submit").offset().top-c("#screen-meta").height()-d;if(f>b-d){if(f+e.height()+10<g){e.css({"box-shadow":"5px 5px 5px #aaa",border:"1px solid #aaa"});e.stop().animate({top:(f-b+d)+"px"},"slow")}}else{e.css({"box-shadow":"",border:""});e.stop().animate({top:0})}})})})(jQuery);
