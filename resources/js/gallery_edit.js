/*
 * Copyright (c) 2011 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
(function(a){a.extend(myatu_bgm,{image_selection:new Object(),getImageCount:function(){return(myatu_bgm.GetAjaxData("image_count",a("#edit_id").val()))},getImagesHash:function(){return(myatu_bgm.GetAjaxData("images_hash",a("#edit_id").val()))},getImageIds:function(){return(myatu_bgm.GetAjaxData("image_ids",a("#edit_id").val()))},removeImagesOverlay:function(){a("#images_iframe").fadeIn("fast",function(){a("#image_iframe_overlay").hide()})},showHideEditBar:function(c){if(c==true){var d=myatu_bgm.getImageIds();for(key in myatu_bgm.image_selection){var g=key.replace("image_","");if(d[g]==undefined){delete myatu_bgm.image_selection[key]}}}var f=a("#quicktags"),b=a("#selected-count"),e=myatu_bgm.GetObjSize(myatu_bgm.image_selection);if(e>0){f.slideDown();b.show();a("#select-count",b).html(e)}else{f.slideUp();b.hide();a("#select-count",b).html("0")}},haveImagesChanged:function(c){var d=a("#images_hash").val(),b=myatu_bgm.getImagesHash();if(b!=false&&d!=b){if(c==true){a("#images_hash").val(b)}return true}return false},loadImagesIframe:function(d){var c=a("#image_iframe_overlay"),b=a("#loader",c);if(d==undefined){d=a("#images_iframe").attr("src")}c.show();a("#image_buttons").hide();b.css("top",((c.height()-b.outerHeight())/2)+c.scrollTop()+"px");b.css("left",((c.width()-b.outerWidth())/2)+c.scrollLeft()+"px");a("#images_iframe").attr("src",d).fadeOut("fast")},showHideImageButtons:function(d){var f=a("#images_iframe").contents().find("#image_buttons");if(d==undefined){d=a("#images_iframe").contents().find(".highlighted:first")}if(!a(d).length){f.hide();return}var e=a("img",d),c=a("#image_iframe_overlay"),b=a("#loader",c);f.css("top",e.offset().top-c.scrollTop()+"px");f.css("left",e.offset().left-c.scrollLeft()+"px");f.show();a("#image_edit_button",f).attr("href",a("#image_iframe_edit_base").val()+"&id="+a(d).attr("id").replace("image_","")+"&TB_iframe=true");a("#image_del_button",f).attr("href","#"+a(d).attr("id").replace("image_",""))},onImagesIframeFinish:function(d){var b=a("#images_iframe").contents().find("html,body"),c=a("#image_container",b);var e=myatu_bgm.GetAjaxData("paginate_links",{id:a("#edit_id").val(),base:a("#images_iframe_base").val(),pp:a("#images_per_page").val(),current:d});if(e!=false){a(".tablenav-pages").html(e);a(".tablenav-pages a").click(myatu_bgm.onPaginationClick)}a("#wp-word-count #image-count").html(myatu_bgm.getImageCount());a(".image",c).each(function(f){a(this).dblclick(myatu_bgm.onImageDoubleClick);a(this).click(myatu_bgm.onImageClick);if(myatu_bgm.image_selection[a(this).attr("id")]==true){a(this).addClass("selected")}});b.click(myatu_bgm.onEmptyImageAreaClick);a("#image_edit_button",b).click(myatu_bgm.onImageEditButtonClick);a("#image_del_button",b).click(myatu_bgm.onImageDeleteButtonClick);b.keydown(myatu_bgm.onIframeKeyDown);myatu_bgm.removeImagesOverlay()},onDeleteSelected:function(d){if(a("#image_del_is_perm").val()=="1"&&confirm(bgmL10n.warn_delete_all_images)==false){return false}var b,c="";for(b in myatu_bgm.image_selection){c+=b.replace("image_","")+","}myatu_bgm.GetAjaxData("delete_images",c);myatu_bgm.showHideEditBar(true);if(myatu_bgm.haveImagesChanged(true)){myatu_bgm.loadImagesIframe()}return false},onClearSelected:function(b){var c=a("#images_iframe").contents().find("#image_container");myatu_bgm.image_selection=new Object();a(".image",c).each(function(d){if(a(this).hasClass("selected")){a(this).removeClass("selected")}});myatu_bgm.showHideEditBar(false);return false},onPaginationClick:function(b){myatu_bgm.loadImagesIframe(a(this).attr("href"));return false},onImageDoubleClick:function(b){var c=a(this).attr("id");a(this).toggleClass("selected");if(a(this).hasClass("selected")){myatu_bgm.image_selection[c]=true}else{delete myatu_bgm.image_selection[c]}myatu_bgm.showHideEditBar(false);return false},onImageClick:function(b){a("#images_iframe").contents().find(".image").removeClass("highlighted");a(this).addClass("highlighted");myatu_bgm.showHideImageButtons(this);return false},onEmptyImageAreaClick:function(b){a("#images_iframe").contents().find(".image").removeClass("highlighted");myatu_bgm.showHideImageButtons()},onImageEditButtonClick:function(b){tb_show(a(this).attr("title"),a(this).attr("href"));return false},onImageDeleteButtonClick:function(b){if(a("#image_del_is_perm").val()=="1"&&confirm(bgmL10n.warn_delete_image)==false){return false}myatu_bgm.GetAjaxData("delete_images",a(this).attr("href").replace("#",""));myatu_bgm.showHideEditBar(true);if(myatu_bgm.haveImagesChanged(true)){myatu_bgm.loadImagesIframe()}return false},onIframeKeyDown:function(e){var c=a("#images_iframe").contents().find("html,body"),f=a("#image_container",c),d=a(".image.highlighted",f);var b=function(h){if(!d.length&&h!=undefined){d=a(".image:"+h,f).addClass("highlighted")}myatu_bgm.showHideImageButtons();if(c.length&&d.length){c.scrollTo(d)}};var g=function(h){return{x:a(h).offset().left,y:a(h).offset().top,w:a(h).outerWidth(),h:a(h).outerHeight()}};switch(e.keyCode){case 32:d.dblclick();return false;case 37:d=d.removeClass("highlighted").prev(".image").addClass("highlighted");b("last");return false;case 39:d=d.removeClass("highlighted").next(".image").addClass("highlighted");b("first");return false}}});a(document).ready(function(b){mainWin.send_to_editor=function(c){tb_remove()};mainWin.tb_remove=function(){b("#TB_imageOff").unbind("click");b("#TB_closeWindowButton").unbind("click");b("#TB_window").fadeOut("fast",function(){b("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()});b("#TB_load").remove();if(typeof document.body.style.maxHeight=="undefined"){b("body","html").css({height:"auto",width:"auto"});b("html").css("overflow","")}document.onkeydown="";document.onkeyup="";if(myatu_bgm.haveImagesChanged(true)){myatu_bgm.loadImagesIframe()}return false};b("#ed_delete_selected").click(myatu_bgm.onDeleteSelected);b("#ed_clear_selected").click(myatu_bgm.onClearSelected)})})(jQuery);
